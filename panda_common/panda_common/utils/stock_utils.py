"""
股票工具函数模块

本模块提供了股票相关的工具函数，就像一个"股票信息助手"，
它可以帮助你识别股票代码所属的交易所，让你可以方便地处理不同格式的股票代码。

核心概念
--------

- **交易所后缀**：股票代码的后缀，用于标识股票所属的交易所
  - `.SH`：上海证券交易所
  - `.SZ`：深圳证券交易所
  - `.BJ`：北京证券交易所

使用方式
--------

1. 调用 `get_exchange_suffix()` 获取标准格式的股票代码
2. 调用 `get_exchange_suffix_tqsdk()` 处理 TqSDK 格式的股票代码

工作原理
--------

就像识别车牌号所属地区：

1. **提取代码**：从股票代码中提取数字部分（就像从车牌号提取数字）
2. **判断前缀**：根据数字前缀判断所属交易所（就像根据数字判断地区）
3. **添加后缀**：添加对应的交易所后缀（就像添加地区标识）
"""

import pandas as pd
import numpy as np


def get_exchange_suffix(code):
    """获取股票代码的交易所后缀

    这个函数就像一个"股票代码识别器"，它会根据股票代码的前缀判断所属的交易所，
    然后返回带交易所后缀的标准格式代码。

    为什么需要这个函数？
    --------------------

    在中国股市，不同交易所的股票代码有不同的前缀：
    - 上海证券交易所：600、601、603、688、689、605、900 开头
    - 深圳证券交易所：000、001、300、200、002、301、201、003、302 开头
    - 北京证券交易所：43、83、87、920 开头

    如果代码没有后缀，系统无法知道股票属于哪个交易所。
    这个函数会自动识别并添加后缀，解决了这个问题。

    工作原理
    --------

    就像识别车牌号所属地区：

    1. **提取代码**：从输入代码中提取数字部分（去掉可能存在的后缀）
       （就像从车牌号提取数字部分）

    2. **判断前缀**：检查代码的前缀，判断属于哪个交易所
       （就像根据车牌号前缀判断地区）

    3. **添加后缀**：添加对应的交易所后缀（.SH、.SZ、.BJ）
       （就像添加地区标识）

    实际使用场景
    -----------

    处理股票代码时使用：

    ```python
    # 输入：不带后缀的代码
    code = "000001"
    # 输出：带后缀的标准格式
    standard_code = get_exchange_suffix(code)  # "000001.SZ"
    ```

    Args:
        code: 股票代码，可以是 "000001" 或 "000001.SZ" 格式

    Returns:
        str: 带交易所后缀的标准格式代码，如 "000001.SZ"
             如果无法识别，返回 "UNKNOWN"

    Example:
        >>> get_exchange_suffix("000001")
        '000001.SZ'
        >>> get_exchange_suffix("600000")
        '600000.SH'
        >>> get_exchange_suffix("430001")
        '430001.BJ'
    """
    # 提取代码的数字部分（去掉可能存在的后缀）
    code = code.split('.')[0]
    
    # 根据代码前缀判断所属交易所
    # 上海证券交易所：600、601、603、688、689、605、900 开头
    if code.startswith(("600", "601", "603", "688", "689", "605", "900")):
        return f"{code}.SH"  # 上海证券交易所
    # 深圳证券交易所：000、001、300、200、002、301、201、003、302 开头
    elif code.startswith(("000", "001", "300", "200", "002", "301", "201", "003", "302")):
        return f"{code}.SZ"  # 深圳证券交易所
    # 北京证券交易所：43、83、87、920 开头
    elif code.startswith(("43", "83", "87", "920")):
        return f"{code}.BJ"  # 北京证券交易所
    else:
        return "UNKNOWN"


def get_exchange_suffix_tqsdk(code):
    """获取 TqSDK 格式股票代码的交易所后缀

    这个函数是专门为 TqSDK 数据源设计的，TqSDK 的股票代码格式是 "交易所.代码"，
    比如 "SHFE.cu2301"，需要从后缀中提取代码。

    为什么需要这个函数？
    --------------------

    TqSDK 数据源的股票代码格式与其他数据源不同：
    - 标准格式：`000001.SZ`（代码.交易所）
    - TqSDK 格式：`SZ.000001`（交易所.代码）

    这个函数专门处理 TqSDK 格式，提取代码并转换为标准格式。

    工作原理
    --------

    1. **提取代码**：从 TqSDK 格式中提取代码部分（在点号后面）
    2. **判断前缀**：根据代码前缀判断所属交易所
    3. **添加后缀**：添加对应的交易所后缀

    Args:
        code: TqSDK 格式的股票代码，如 "SZ.000001"

    Returns:
        str: 带交易所后缀的标准格式代码，如 "000001.SZ"
             如果无法识别，返回 "UNKNOWN"

    Example:
        >>> get_exchange_suffix_tqsdk("SZ.000001")
        '000001.SZ'
        >>> get_exchange_suffix_tqsdk("SH.600000")
        '600000.SH'
    """
    # TqSDK 格式是 "交易所.代码"，需要提取点号后面的代码部分
    code = code.split('.')[1]
    
    # 根据代码前缀判断所属交易所
    # 上海证券交易所：600、601、603、688、689 开头
    if code.startswith(("600", "601", "603", "688", "689")):
        return f"{code}.SH"  # 上海证券交易所
    # 深圳证券交易所：000、001、300、320 开头
    elif code.startswith(("000", "001", "300", "320")):
        return f"{code}.SZ"  # 深圳证券交易所
    # 北京证券交易所：43、83 开头
    elif code.startswith(("43", "83")):
        return f"{code}.BJ"  # 北京证券交易所
    else:
        return "UNKNOWN"